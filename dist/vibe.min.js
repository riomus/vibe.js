/*! vibe 14-01-2015 */
!function(a){"use strict";var b=function(a){this.config={width:400,height:300,samplesNumber:10,colorDistanceSphereRadius:20,numberOfCloseSamplesForBeingPartOfBackground:1,ammountOfRandomSubsampling:5,randomNeighbourMovements:[-1,0,1]};for(var b in a)this.config[b]=a[b];var c=this.config.width*this.config.height*4;this.initializeModel=function(a){this.backgroundModels=[];for(var b=function(b,c){var e=this._calculateIndexFromCoordinates(b,c),f=this._getRandomNeighbour(b,c),g=this._calculateIndexFromCoordinates(f[0],f[1]);this._rewriteColors(a,this.backgroundModels[d],g,e)}.bind(this),d=0;d<this.config.samplesNumber;d++)this.backgroundModels[d]=new Uint8ClampedArray(c),this._forEachPixel(b)},this.getNextFrame=function(a){var b=new Uint8ClampedArray(c);return this._forEachPixel(function(c,d){for(var e=0,f=0,g=this._calculateIndexFromCoordinates(c,d);e<this.config.numberOfCloseSamplesForBeingPartOfBackground&&f<this.config.samplesNumber;){var h=this.backgroundModels[f];this.config.colorDistanceSphereRadius>this._distanceBetweanPixels(h,a,g)&&e++,f++}if(e>=this.config.numberOfCloseSamplesForBeingPartOfBackground){for(var i=0;3>i;i++)b[g+i]=0;if(b[g+3]=255,this._shouldRandomSubsample()&&(f=Math.round(Math.random()*(this.config.samplesNumber-1)),this._rewriteColors(a,this.backgroundModels[f],g,g)),this._shouldRandomSubsample()){f=Math.round(Math.random()*(this.config.samplesNumber-1));var j=this._getRandomNeighbour(c,d),k=this._calculateIndexFromCoordinates(j[0],j[1]);this._rewriteColors(a,this.backgroundModels[f],g,k)}}else this._rewriteColors(a,b,g,g)}.bind(this)),b},this._rewriteColors=function(a,b,c,d){for(var e=0;4>e;e++)b[d+e]=a[c+e]},this._shouldRandomSubsample=function(){return 0===Math.round(Math.random()*(this.config.ammountOfRandomSubsampling-1))},this._distanceBetweanPixels=function(a,b,c){for(var d=0,e=0;4>e;e++)d+=a[c+e]-b[c+e];return Math.abs(d/4)},this._forEachPixel=function(a){for(var b=0;b<this.config.width;b++)for(var c=0;c<this.config.height;c++)a(b,c)},this._calculateIndexFromCoordinates=function(a,b){return 4*(a+b*this.config.width)},this._betweanValues=function(a,b,c){return Math.max(b,Math.min(c,a))},this._getRandomMovement=function(){var a=Math.round(Math.random()*(this.config.randomNeighbourMovements.length-1));return this.config.randomNeighbourMovements[a]},this._getRandomNeighbour=function(a,b){var c=this._betweanValues(a+this._getRandomMovement(),0,this.config.width-1),d=this._betweanValues(b+this._getRandomMovement(),0,this.config.height-1);return[c,d]}};b.VERSION="0.0.0",a.ViBE=b;var c=function(a){this.config={};for(var b in a)this.config[b]=a[b];c.base(this,"constructor")};a.tracking.inherits(c,tracking.Tracker),c.prototype.track=function(a,c,d){if(this.initialized2||0===a[0]||(this.config.width=c,this.config.height=d,this.vibeService=new b(this.config),this.vibeService.initializeModel(new Uint8ClampedArray(a)),this.initialized2=!0),this.initialized2){var e=this.vibeService.getNextFrame(new Uint8ClampedArray(a));this.emit("track",{frame:e,beforeProcessingFrame:a})}},c.VERSION="0.0.0",a.ViBETracker=c}(this);